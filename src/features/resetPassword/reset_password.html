<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="../../../src/features/resetPassword/reset_password.css">
</head>

<body>
    <main>
        <div class="rt">
            <img src="../../../public/assets/images/RT-Logo.png" alt="RT" class="rtLogo">
            <div class="login-box">
                <header>
                    <span class="text-center">RESET PASSWORD</span>
                    <div class="lines">
                        <img src="../../../public/assets/images/single white line rt.png" alt="Line" class="singleLine">
                        <img src="../../../public/assets/images/single white line rt.png" alt="Line" class="singleLine">
                    </div>
                </header>
                <form id="resetPasswordForm">
                    <div class="input">
                        <label for="newPassword" class="form-label">NEW PASSWORD</label>
                        <input type="password" id="newPassword" class="form-control" required>
                    </div>
                    <div class="input">
                        <label for="confirmPassword" class="form-label">CONFIRM PASSWORD</label>
                        <input type="password" id="confirmPassword" class="form-control" required>
                    </div>
                    <div class="buttons">
                        <button type="submit" class="button click-animation hover-animation">SUBMIT <img
                                src="../../../public/assets/images/arrow black rt.png" alt="arrow"
                                class="arrow"></button>
                        <div class="sign">
                            <span>REMEMBERED PASSWORD?</span>
                            <a href="../../../index.html">LOGIN</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Extract token from query parameters
        function getTokenFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('token');
        }

        // Handle form submission
        document.getElementById('resetPasswordForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const token = getTokenFromURL();

            if (newPassword !== confirmPassword) {
                alert("Passwords do not match!");
                return;
            }

            try {
                const response = await fetch("https://rtsa-backend-gpu-843332298202.us-central1.run.app/reset_password", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        token: token,
                        new_password: newPassword,
                    }),
                });

                const result = await response.json();
                console.log("Reset Response:", result);

                if (result.message) {
                    alert(result.message);
                    window.location.href = "index.html"; // Redirect to login
                } else {
                    alert("Something went wrong. Please try again.");
                }

            } catch (error) {
                console.error("Reset Password Error:", error);
                alert("An error occurred. Please try again later.");
            }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>

</html>